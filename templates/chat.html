<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DialoGPT Chatbot</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .chat-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .messages {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 20px;
            background-color: #fafafa;
        }
        
        .message {
            margin: 10px 0;
            padding: 8px 12px;
            border-radius: 18px;
            max-width: 70%;
        }
        
        .user-message {
            background-color: #007bff;
            color: white;
            margin-left: auto;
            text-align: right;
        }
        
        .bot-message {
            background-color: #e9ecef;
            color: #333;
        }
        
        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .input-container {
            display: flex;
            gap: 10px;
        }
        
        #messageInput {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
        }
        
        #sendButton {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }
        
        #sendButton:hover {
            background-color: #0056b3;
        }
        
        #sendButton:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        
        .loading {
            color: #666;
            font-style: italic;
        }
        
        .debug-info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <h1>DialoGPT Chatbot</h1>
        <button onclick="testServer()">Test Server Connection</button>
        <div id="messages" class="messages"></div>
        <div class="input-container">
            <input type="text" id="messageInput" placeholder="Type your message here..." autocomplete="off">
            <button id="sendButton">Send</button>
        </div>
    </div>

    <script>
        const messagesDiv = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');

        function addMessage(message, className = 'bot-message') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${className}`;
            messageDiv.textContent = message;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function addDebugInfo(info) {
            const debugDiv = document.createElement('div');
            debugDiv.className = 'debug-info';
            debugDiv.textContent = `Debug: ${info}`;
            messagesDiv.appendChild(debugDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function testServer() {
            addDebugInfo('Testing server connection...');
            fetch('/test')
                .then(response => {
                    addDebugInfo(`Server response status: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    addDebugInfo(`Server test successful: ${JSON.stringify(data)}`);
                })
                .catch(error => {
                    addDebugInfo(`Server test failed: ${error.message}`);
                });
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            // Disable send button
            sendButton.disabled = true;

            // Add user message
            addMessage(message, 'user-message');
            messageInput.value = '';
            
            // Show loading
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message bot-message loading';
            loadingDiv.textContent = 'Bot is typing...';
            loadingDiv.id = 'loading-message';
            messagesDiv.appendChild(loadingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            addDebugInfo(`Sending message: "${message}"`);

            // Send to server
            const formData = new FormData();
            formData.append('msg', message);

            fetch('/get', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                addDebugInfo(`Response status: ${response.status}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                // Remove loading message
                const loading = document.getElementById('loading-message');
                if (loading) messagesDiv.removeChild(loading);
                
                addDebugInfo(`Received data: ${JSON.stringify(data)}`);
                
                if (data.error) {
                    addMessage('Error: ' + data.error, 'error-message');
                } else {
                    addMessage(data.response, 'bot-message');
                }
            })
            .catch(error => {
                // Remove loading message
                const loading = document.getElementById('loading-message');
                if (loading) messagesDiv.removeChild(loading);
                
                addDebugInfo(`Fetch error: ${error.message}`);
                addMessage('Error: Failed to get response - ' + error.message, 'error-message');
                console.error('Error:', error);
            })
            .finally(() => {
                // Re-enable send button
                sendButton.disabled = false;
            });
        }

        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !sendButton.disabled) {
                sendMessage();
            }
        });

        // Add welcome message
        addMessage('Hello! I\'m a DialoGPT chatbot. How can I help you today?');
    </script>
</body>
</html>
